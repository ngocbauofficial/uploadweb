var PreLoader=function(){function e(e){e=e||{},I=this,t(),O=e.materials,x=e.layerNum,R=e.parentStage}function t(){A=0,S=0,E=[],L=[],O=[],M=6,w=!1,D={},N=[],x=0}function i(e){h(),w=!1,S=0,A=e.length,L=e,E.length=0;for(var t=L.length,i=0;t>i;i++){if(0===L.length)return;if(E.length>=M)return;if(f())return;a()}}function a(){if(!f()&&p()){var e=L.splice(0,1)[0],t=e.src,i=e.id,r=e.angle,s=$("#"+i);if(0===s.size()){var o=$(R.find(".angle"+r).get(0)),d=$("<img />").addClass("layer"+e.layer).addClass("drawTarget").attr("draggable",!1).attr("id",i).css("zIndex",100*r+e.layer);n(d,e),o.append(d),d.attr("src",t),E.push(d)}else if(e.src===s.attr("src")){if(s.css("visibility",""),S++,v(e),0===E.length&&l())return c(),void 0;p()&&a()}else n(s,e),s.attr("src",t),E.push(s)}}function n(e,t){e.on("load",t,s),e.on("error",t,o)}function r(e){e.off("load",s),e.off("error",o)}function s(e){var t=e.data;if(m(t.materialPath)&&(S++,g(this),v(t),r($(this)),d(e,this),$("#"+t.id).css("visibility","")),l())return c(),void 0;if(p())for(var i=M-E.length,n=0;i>n&&p();n++)a()}function o(e){var t=e.data;return m(t.materialPath)&&(S++,g(this),v(t),r($(this)),u(e,this),this.removeAttribute("src"),$(this).css("visibility","hidden")),l()?(c(),void 0):(p()&&a(),void 0)}function l(){return A===S?!0:!1}function d(e,t){if(!f()){var i=jQuery.Event("fileload",{item:e.data,imgData:t});$(I).trigger(i)}}function c(){$(I).trigger("allFileload")}function u(){}function h(){}function g(e){if(e)for(var t=0;E.length>t;t++){var i=E[t].get(0);if(i==e)return E.splice(t,1),void 0}}function f(){return w?!0:!1}function p(){return 0!==L.length?!0:!1}function v(e){var t=e.angle,i=e.materialId;N[t]instanceof Array?N[t].push(i):N[t]=[i],N[t].length==x&&_(t)}function m(e){for(var t=0;O.length>t;t++)if(O[t].material===e)return!0;return!1}function _(e){var t=jQuery.Event("singleAngleLoad",{angle:e});$(I).trigger(t)}function y(e){M=e}function T(){w=!0}function b(e,t,i,a){function n(e,t){return t?e==i-1?e=0:e++:0===e?e=i-1:e--,e}for(var r=e,s=0;i>s;s++){r=n(r,t);var o=N[r];if(o&&o.length===a)return r}return e}function C(e){O=e.materials,x=e.layerNum,R=e.parentStage}var I,A,S,E,L,O,R,M=6,w=!1,D={},N=[],x=0;return e.prototype={init:t,cancelLoad:T,setMaxConnections:y,loadManifest:i,getNextShowAngle:b,setOptions:C},e}(),ConfigCore=function(){function e(e){var i=$.Deferred();return g.push($.ajax({type:"GET",url:e,dataType:"json",dataFilter:function(e){return e=t(e),e=e.split("\\n").join("<br>")},success:function(e){for(var t in e);switch(t){case"GRADE":l.grade_list=e[t];break;case"ITEMS":l.item_list=e[t];break;case"MATERIALS":l.materials_list=e[t];break;case"COMBINATIONS":l.combination_list=e[t];break;case"FEATURES":l.feature_list=e[t]}i.resolve()},error:function(){i.reject()}})),i.promise()}function t(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split("&").join("&amp;").split("'").join("&#39;")}function i(e){switch(e){case"loadComplete":$(l).trigger("loadComplete");break;case"loadFailed":$(l).trigger("loadFailed")}}function a(e,t){""!=t&&null!=t&&(this.validateCombination=t);for(var i=0;e.length>i;i++){var r=e[i];if(""!=r&&"null"!=r&&""!=this.validateCombination[r]&&null!=this.validateCombination[r]){for(var s=e.join(","),o=this.validateCombination[r],c=o.invalid,u=0;c.length>u;u++){var g=RegExp("\\b"+c[u]+"\\b"),f=s.match(g);if(f){var p=f[0].split("_")[0];p=jsonPath(l.item_list,"$.[?(@.group_id =='"+p+"')]")[0],s="radio"!=p.type?s.replace(g,f[0]+h):s.replace(g,n(c,p.items))}s=","==s.charAt(0)?s.replace(",",""):s.replace(",,",",")}for(var v=o.valid,m=0;v.length>m;m++){var $=RegExp("\\b"+v[m]+"\\b");$.test(s)||(s+=","+v[m]),s=","==s.charAt(0)?s.replace(",",""):s.replace(",,",",")}if(e.join(",")!=s){e=s.split(","),e=a(e,t);break}}}return d.join(",")==e.join(","),e}function n(e,t){for(var i=0;t.length>i;i++){for(var a=!1,n=0;e.length>n;n++){var r=RegExp("\\b"+e[n]+"\\b");r.test(t[i].item_id)&&(a=!0)}if(!a)return t[i].item_id}}function r(e){for(var t=[],i=0;e.length>i;i++){var a=e[i];if(""!=a&&"null"!=a&&""!=this.validateCombination[a]&&null!=this.validateCombination[a]){var n=this.validateCombination[a],r=n.invalid;$(r).each(function(e,i){var a=RegExp("\\b"+i+"\\b"),n=t.join(",");a.test(n)||t.push(i)})}}return t}function s(e,t){for(var i={},a=0;t.length>a;a++){var n=t[a],r=RegExp("\\b"+n+"\\b"),s=e.join(","),o=s.search(r);if(-1==o){var d=n.split("_")[0];d=jsonPath(l.item_list,"$.[?(@.group_id =='"+d+"')]")[0];var c;if("radio"!=d.type){var u=RegExp(h+"$");u=u.test(n)?RegExp("\\b"+n.replace(u,"")+"\\b"):RegExp("\\b"+n+h+"\\b"),s=e.join(","),c=u.exec(s),i[c]=n}else for(var g=0;e.length>g;g++)if(c=e[g],r=RegExp("\\b"+c+"\\b"),s=jsonPath(d.items,"$..item_id").join(","),r.test(s)){i[c]=n;break}}}return i}function o(){return l?l:(l=this,this.grade_list="",this.item_list="",this.materials_list="",this.combination_list="",this.feature_list="",l)}var l,d=[],c=[],u=[],h="_I",g=[];return o.getInstance=function(){return l||(l=new o),l},o.prototype.loadSetting=function(t){if(g){for(var a=g.length,n=0;a>n;n++)4!=g[n].readyState&&g[n].abort();g=[]}var r,s=[];if("string"==typeof t)r=e(t),s.push(r);else for(var o in t.files)t.files.hasOwnProperty(o)&&(r=e(l.grade_list.jsonDirPath+t.files[o]),s.push(r));$.when.apply($,s).done(function(){i("loadComplete")}).fail(function(){i("loadFailed")})},o.prototype.validate=function(e){d=e;var t=a(e,this.combination_list),i=r(t),n=s(e,t);return d=t,c=i,u=n,{selectItems:d,disabledItems:c,autoChangeItems:u}},o.prototype.getDisplayMaterials=function(e,t){for(var i=[],a=0;e.length>a;a++){for(var n=!1,r=0;e[a].items.length>r;r++){var s=e[a].items[r],o="\\b"+s+"\\b",l=RegExp(o);if(o=t.join(","),!l.test(o)){n=!1;break}n=!0}n&&i.push({material:e[a].material,layer:e[a].layer})}return i},o}(),ConfigView=function(){function e(e){e=e||{},k||(k=$(e.loadingIndicator));var t=$(e.displayTarget),i=t.find(".stage"),a=t.find(".tmp"),n=e.numAngles,r=e.numAngleStep,s=Math.round(n/r),o=e.materialDirPath,l=[],d=[],c=0,u=0,h=!1,g=!1;this.getDisplayTarget=function(){return t},this.getDisplayStage=function(){return i},this.getTmpDisplayTarget=function(){return a},this.getNumAngleStep=function(){return r},this.getAngleStep=function(){return s},this.getMaterialDirPath=function(){return o},this.getCurrentLayers=function(){return l},this.getNewLayers=function(){return d},this.getCurrentAngle=function(){return c},this.getLayerNum=function(){return u},this.isInitBase=function(){return h},this.isInitTarget=function(){return g},this.setCurrentLayers=function(e){l=e},this.setNewLayers=function(e){d=e},this.setCurrentAngle=function(e){c=e},this.setLayerNum=function(e){u=e},this.setInitBaseFlg=function(e){h=e},this.setShowTargetInitFlg=function(e){g=e},this.getDisplayTargetSize=function(){return{width:t.width(),height:t.height()}}}function t(){var e=this;0===k.children().size()&&e._createLoadingIndicator()}function i(){var e=this.getDisplayStage();e.parent().show()}function a(){var e=this.getDisplayStage();e.parent().hide()}function n(e,t,i){for(var a=RegExp(j+"$"),n=0;t.groups.length-1>=n;n++){var r=jsonPath(t.groups[n].items,"$.[?(@.subItem)]");for(var s in r)if(r.hasOwnProperty(s)){var o=jsonPath(t.groups[n].items,"$.[?(@.item_id =='"+r[s].subItem+"')]");o&&(o=o[0],o.subMenu||(o.subMenu=[]),r[s].item_id!=o.item_id&&o.subMenu.push(r[s]))}var l=t.groups[n];if("radio"!=l.type)for(var d=jsonPath(l.items,"$.[?(@.checked==false)]"),c=0;d.length>c;c++)a.test(d[c].item_id)||(d[c].item_id=d[c].item_id+j);$(i).tmpl(t.groups[n]).appendTo(e)}}function r(e,t){var i=t.getNumAngleStep();this.setLayerNum(e.length);for(var a=$("<div/>"),n=document.createDocumentFragment(),r=$("<img />").addClass("drawTarget").attr("draggable",!1),s=0;i>s;s++){for(var o=a.clone(!0).addClass("angle"+s).css("visibility","hidden"),l=0;e.length>l;l++){var d=this._createMaterialId(e[l].material),c=r.clone(!0);c.css("zIndex",100*s+e[l].layer),c.attr("id",s+"-"+d),c.addClass("layer"+e[l].layer),o.append(c)}$(n).append(o)}var u=t.getDisplayStage();u.append(n),this.setInitBaseFlg(!0)}function s(){var e=k,t=$("<div/>");t.attr("id","floatingBarsG");for(var i=1;8>=i;i++){var a=$("<div/>"),n="rotateG_0"+i;a.attr("id",n),a.addClass("blockG"),t.append(a)}e.append(t)}function o(){function e(e){if(e.preventDefault(),g.on("mousemove.move touchmove","div",t),g.on("mouseup touchend",i),l=$(this),n=g.find("div"),o=$(this).width()/h,"touchstart"==e.type){var a=e.originalEvent.touches[0];r=a.pageX,s=Math.round(a.pageX/o)}else r=e.pageX,s=Math.round(e.pageX/o)}function t(e){e.preventDefault();var t,i=n.index(l);if("touchmove"==e.type){var r=e.originalEvent.touches[0];t=Math.round(r.pageX/o)}else t=Math.round(e.pageX/o);t>s&&0!==t?(c=W.getNextShowAngle(i,!0,h,u.getLayerNum()),d=n.eq(c),a(l,d),l=d):s>t&&0!==t&&(c=W.getNextShowAngle(i,!1,h,u.getLayerNum()),d=n.eq(c),a(l,d),l=d),s=t,u.setCurrentAngle(c),u._dispatchAngleChange(c),i=null,t=null}function i(){g.off("mousemove.move touchmove"),g.off("mouseup touchend"),n=null,r=null,s=null,o=null,l=null,d=null}function a(e,t){$(e).css("visibility","hidden"),$(t).css("visibility","visible")}var n,r,s,o,l,d,c,u=this,h=this.getNumAngleStep(),g=this.getDisplayStage();g.on("mousedown touchstart","div",e)}function l(){var e=this.getDisplayStage();e.off("mousedown touchstart","div"),e.off("mousemove.move touchmove","div"),e.off("mouseup touchend")}function d(){var e=k;e.hide(),this._addRotationListners()}function c(){var e=k;e.show(),this._removeRotationListners()}function u(e,t,i){var a,n="_",r="",s=this.getMaterialDirPath();if(t=t*this.getAngleStep()+1,X!=(t+"").length)for(var o=0;X-(t+"").length>o;o++)n+="0";return n+=t+"",0===i?(r=".jpg",a=s+e+"/"+e+n+r):(r=".png",a=s+e+"/"+e+n+r),a}function h(e){for(var t=e.split("-"),i="",a=0;2>a;a++){var n=t[a].split("_");i+=a?"_"+n[0]:n[0]}return i}function g(e){var t=this;t.isInitBase()||t.createBaseImgObjWrapper(e,t),t._showIndicator(),null!=W&&t._closeLoader(),t.setShowTargetInitFlg(!1),t._initLoader(e),t.setLayerNum(e.length);var i=t._createManifest(e,t.getCurrentAngle()),a=i.manifest,n=t.getNewLayers();n&&t.setCurrentLayers(n),t.setNewLayers(i.layers);var r=t._gethidenTargetLayers(t.getNewLayers());this._cloneVisibleAngleImgs(),W.loadManifest(a),t._hiddenLayers(r)}function f(){this._removeTempAngleImgs();var e=$("#angle"+this.getCurrentAngle()).clone(!1).children(),t=this.getTmpDisplayTarget();e.removeAttr("id"),t.append(e).show(),this._hideVisibleAngleImgs()}function p(){var e=this.getTmpDisplayTarget();e.hide().empty()}function v(){$("#angle"+this.getCurrentAngle()).css("visibility","hidden")}function m(e){for(var t=this.getCurrentLayers(),i=t.concat([]),a=0;e.length>a;a++){var n=i.indexOf(e[a]);n>=0&&i.splice(n,1)}return i}function _(e){for(var t=0;e.length>t;t++)$(".layer"+e[t]).css("visibility","hidden")}function y(){try{W.cancelLoad(),this._closeLoader()}catch(e){}}function T(e,t){this._hideIndicator();var i=[],a=this.getDisplayStage();a.find(".angle"+this.getCurrentAngle()).css("visibility","visible"),this._removeTempAngleImgs(),this.setShowTargetInitFlg(!0);for(var n=this.getNumAngleStep(),r=this._createWaitingArry(n),s=r.indexOf(this.getCurrentAngle()),o=1;r.length>o;o++){s++,s==n&&(s=0);var l=this._createManifest(t,r[s]);i=i.concat(l.manifest)}W.loadManifest(i)}function b(e,t){for(var i=[],a=[],n=0;e.length>n;n++){a.push(e[n].layer);var r=this._createMaterialId(e[n].material),s=this._getImgPath(e[n].material,t,e[n].layer),o={};o.src=s,o.id=t+"-"+r,o.angle=t,o.materialId=r,o.layer=e[n].layer,o.materialPath=e[n].material,i.push(o)}return{manifest:i,layers:a}}function C(e){W?(W.init(),W.setOptions({materials:e,layerNum:e.length,parentStage:this.getDisplayStage()})):(W=new PreLoader({materials:e,layerNum:e.length,parentStage:this.getDisplayStage()}),W.setMaxConnections(6));var t=this,i={self:t,materials:e};$(W).on("loadStart",this._handleLoadStart),$(W).on("fileload",this._handleFileLoad),$(W).on("singleAngleLoad",t,this._handleSingleAngleLoad),$(W).on("allFileload",i,this._handleComplete),$(W).on("error",this._handleError)}function I(){$(W).off("loadStart",this._handleLoadStart),$(W).off("fileload",this._handleFileLoad),$(W).off("singleAngleLoad",this._handleSingleAngleLoad),$(W).off("allFileload",this._handleComplete),$(W).off("error",this._handleError)}function A(){}function S(){}function E(e){var t=jQuery.Event("singleAngleLoad",e),i=e.data;$(i).trigger(t)}function L(e){var t=e.data,i=t.self;i.isInitTarget()?i._allCompleteHandler(e):i._initAngleImgsLoadedHandler(e,t.materials)}function O(){}function R(){}function M(e){if(e>=0){var t=jQuery.Event("angleChange",{angle:e}),i=this;$(i).trigger(t)}}function w(e){B=[],P=[];for(var t=e,i=[],a=4,n=[],r=[],s=0;t>s;s++)B.push(s);for(;a>P.length;)this._recombineArr(B);for(var o=0;P.length>o;o++)0===o%2?r.push(P[o]):n.push(P[o]);for(P=r.concat(n);t>i.length;)for(var l=0;a>l;l++)P[l][0]!==void 0&&i.push(P[l].shift());return i}function D(e){var t=[];if(e[0]instanceof Array)for(var i=0;e.length>i;i++){var a=N(e[i]);t=t.concat(a)}else t=this._divisionArr(e);P=t,B=P}function N(e){var t=[],i=Math.ceil(e.length/2);return t.push(e.slice(0,i)),t.push(e.slice(i)),t}function x(){}var B,P,X=2,j="_I",W=null,k=null;return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var a=0;if(arguments.length>1&&(a=Number(arguments[1]),a!=a?a=0:0!==a&&1/0!=a&&a!=-1/0&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=i)return-1;for(var n=a>=0?a:Math.max(i-Math.abs(a),0);i>n;n++)if(n in t&&t[n]===e)return n;return-1}),e.prototype={init:t,createSelection:n,createBaseImgObjWrapper:r,preloadManager:g,cancelLoad:y,showStage:i,hideStage:a,_showIndicator:c,_hideIndicator:d,_removeRotationListners:l,_createManifest:b,_getImgPath:u,_cloneVisibleAngleImgs:f,_removeTempAngleImgs:p,_hideVisibleAngleImgs:v,_initLoader:C,_handleLoadStart:A,_handleFileLoad:S,_handleSingleAngleLoad:E,_handleComplete:L,_handleError:O,_allCompleteHandler:R,_initAngleImgsLoadedHandler:T,_addRotationListners:o,_closeLoader:I,_createLoadingIndicator:s,_createMaterialId:h,_gethidenTargetLayers:m,_hiddenLayers:_,_dispatchAngleChange:M,_createWaitingArry:w,_recombineArr:D,_divisionArr:N,_displayConsole:x},e}(),ConfigFeatureView=function(){function e(e){return f?(t(e),f):(f=this,e=e||{},p=this,m=e.displayTargetId,_=$(m),C=e.templateId,A=e.parentViewSize,I=e.baseSize,S=$("<div/>").attr("id",O),E=$("<div/>").attr("id",R),t(e),f)}function t(e){v=e.features,y=e.angle,A=e.parentViewSize,T=e.step,b=e.numAngleStep,M=[],w={},i(),v&&a()}function i(){S.empty(),E.empty()}function a(){w=s(),S.append(w.fragment),_.append(S)}function n(){_.append(E),$(C).tmpl(w.tmplDisplayObj).appendTo(E)}function r(e){for(var t=A.width/I.stageW,i=A.height/I.stageH,a=[],n=0;b>n;n++){var r=e[n*T].x,s=e[n*T].y;(0===r||r)&&(r*=t),(0===s||s)&&(s*=i);var o={x:r,y:s};a.push(o)}return a}function s(){var e=$("<span/>"),t=[],i=document.createDocumentFragment();for(var a in v)if(v.hasOwnProperty(a)){var n=e.clone(!0),s=v[a];if(s.visible){t.push(s),M.push(s.feature_id);var l=r(s.positions);s.adjustedPositions=l;var c=l[y].x,u=l[y].y;o(c,u)&&(n.hide(),c=0,u=0),n.attr("id",s.feature_id).css({top:u,left:c}),d(n),$(i).append(n)}}return{fragment:i,tmplDisplayObj:t}}function o(e,t){return 0!==e&&!e||0!==t&&!t?!0:!1}function l(e){if(0!==M.length)for(var t=0;M.length>t;t++){var i=v[M[t]].adjustedPositions[e],a=i.x,n=i.y,r=$("#"+M[t]);o(a,n)?(r.hide(),a=0,n=0):r.show(),r.css({top:n,left:a})}}function d(e){e.on("click",function(){0===E.children().size()&&n();var e=$(this).attr("id"),t=$("#"+R);t.children().hide(),t.find("#"+e).show(),u(e)})}function c(){$("#"+R).children().hide(),g()}function u(e){if(x==e)return!1;x=e;var t=$("#"+R);return L=t.find("#"+e).find("img"),D=0,N=0,L.css({"z-index":0}).hide(),L.eq(0).css({"z-index":1}).show(),clearInterval(B),1>=L.length?!1:(B=setInterval(function(){var e=D+1==L.length?0:D+1;h(e)},1e3*X+1e3*P),void 0)}function h(e){var t=D;N++,N>1e3&&(L.css({"z-index":0}),L.eq(t).css({"z-index":1}),N=2),L.eq(e).css({"z-index":N}).stop().hide().fadeTo(1e3*P,1),D=e}function g(){clearInterval(B),x=""}var f,p,v,m,_,y,T,b,C,I,A,S,E,L,O="fp-positions",R="fp-descriptions",M=[],w={},D=0,N=0,x="",B=null,P=.3,X=2.5;return e.getInstance=function(){return f||(f=new e),f},e.prototype={init:t,changeAngle:l,hideAllDescriptions:c},e}();$(function(){function e(e){e.preventDefault(),f=!0,l="touchstart"==e.type?e.originalEvent.touches[0].pageX:e.pageX,d="touchstart"==e.type?e.originalEvent.touches[0].pageY:e.pageY,a()}function t(e){if(e.preventDefault(),f){var t="touchmove"==e.type?e.originalEvent.touches[0].pageX:e.pageX,i="touchmove"==e.type?e.originalEvent.touches[0].pageY:e.pageY,n=t-l,r=i-d;u+=.25*n,c+=.25*r,l=t,d=i,a()}}function i(e){e.preventDefault(),f=!1,a()}function a(){g-=u+g,h+=c-h,h>n?(h=n,c=n):-n>h&&(h=-n,c=-n),0!=r&&(g>r?(g=r,u=-r):-r>g&&(g=-r,u=r)),o.css("-webkit-transform","rotateX("+h+"deg) rotateY("+g+"deg)"),o.css("-moz-transform","rotateX("+h+"deg) rotateY("+g+"deg)"),o.css("-ms-transform","rotateX("+h+"deg) rotateY("+g+"deg)"),o.css("transform","rotateX("+h+"deg) rotateY("+g+"deg)")}var n=63,r=0,s=$("#interiorStage"),o=$("#INT_BOX"),l=-10,d=0,c=-10,u=0,h=-10,g=0,f=!1;s.on("mousedown touchstart","div",e),s.on("mousemove touchmove","div",t),s.on("mouseup touchend","div",i),a()}),function(){function e(){C=new ConfigCore,$(C).bind("loadComplete",x),$(C).bind("loadFailed",function(){}),C.loadSetting("../assets/setting/grade_list.json")}function t(){if(!L&&(L=$("#interiorStage"),!N)){var e=$("#interiorStage").width(),t=$("#interiorStage").height();$("#interiorStage").flash({swf:"../assets/image/InteriorView.swf",height:t,width:e,wmode:"transparent",id:"InteriorView",name:"InteriorView"})}$("#loadingIndicator").stop(!0).show(10).delay(2e3).hide(10)}function i(){var e,t,i=$(".modeBtn.selected").attr("id");"EXTERIOR"===i&&(e=C.feature_list.EXT,t=b.getDisplayTargetSize()),e||(e={}),O=new ConfigFeatureView({features:e,displayTargetId:"#func-point",angle:b.getCurrentAngle(),step:b.getAngleStep(),numAngleStep:b.getNumAngleStep(),templateId:"#TMPL_SP_DESCRIPTION",parentViewSize:t,baseSize:C.feature_list.stage})}function a(){var e=$("#GRADE_LIST dd");e.on("click",function(t){t.stopPropagation(),t.returnValue=!1,e.removeClass(M),$(this).addClass(M),$("#EXT_BACKGROUND div.slideAreaWrap").empty(),$("#EXT_BODY_COLOR div.slideAreaWrap").empty(),$("#EXT_WHEEL div.slideAreaWrap").empty(),$("#EXT_OPTION_ACCESSORY div.slideAreaWrap").empty(),$("#INT_BASE div.slideAreaWrap").empty(),o($("#GRADE_LIST .GRD.selected").attr("id"))})}function n(){$("#modeSelect").on("click",".modeBtn",function(){var e=$(this).attr("id");$("#modeSelect .modeBtn").removeClass(M),$(this).addClass(M),$("#selectMenu ul.menuTab li").removeClass("tabOn"),$("#selectMenu .selectMenuWrapper>div").hide(),"EXTERIOR"===e?(i(),L&&L.hide(),b.showStage(),$("#gradeName").show(),$(".menuTab .extTab").show(),$(".menuTab .intTab").hide(),$(".menuTab li.menuTab-GRD").addClass("tabOn"),$("#GRADE_LIST").show(),$("#indicator").show(),$("#featuresSwitch").show(),$("#featuresSwitch .fpSwitchBtn").hasClass("on")&&$("#func-point").show(),clearInterval(R)):"INTERIOR"===e&&(b.hideStage(),L.show(),$("#gradeName").hide(),$(".menuTab .extTab").hide(),$(".menuTab .intTab").show(),$(".menuTab li.menuTab-INT_COL").addClass("tabOn"),$("#INT_BASE").show(),$("#indicator").hide(),$("#featuresSwitch").hide(),$("#func-point").hide(),O.hideAllDescriptions());var t=l();g(t)})}function r(){$(".selectMenuWrapper").on("click",".subMenuBtn",function(e){e.stopPropagation(),e.returnValue=!1,$(this).siblings(".subMenu").toggle()}),$(".selectMenuWrapper").on("click","dd.radioType:not(.noConfig)",function(){b.cancelLoad();var e=$(".subMenu",this);e.is(":visible")&&e.hide();var t=$(this).attr("id"),i=t.split("_"),a=i[0],n=$("#"+a+" .selected").attr("id"),r=l(n,t);g(r,this)}),$(".selectMenuWrapper").on("click","div.radioType:not(.noConfig)",function(e){e.stopPropagation(),e.returnValue=!1,b.cancelLoad();var t=$(this).attr("data-subitemid"),i=t.split("_"),a=i[0],n=$("#"+a+" .selected").attr("id"),r=l(n,t);g(r,this)}),$(".selectMenuWrapper").on("click","dd.checkType:not(.noConfig)",function(){b.cancelLoad();var e=$(".subMenu",this);e.is(":visible")&&e.hide();var t=$(this).attr("id");m(this);var i=$(this).attr("id"),a=l(t,i);g(a,this)}),$(".selectMenuWrapper").on("click","div.checkType:not(.noConfig)",function(e){e.stopPropagation(),e.returnValue=!1,b.cancelLoad();var t=$(this).attr("data-subitemid");m(this);var i=$(this).attr("data-subitemid"),a=l(t,i);g(a,this)}),$(".selectMenuWrapper").on("click","dd.mixType:not(.noConfig)",function(e){b.cancelLoad();var t=$(".subMenu",this);0==$(e.target).parents("dd.selected").length?t.show():t.hide();var i=$(this).attr("id"),a=i.split("_"),n=a[0],r=$("#"+n+" .selected").attr("id");r&&r!=i?m($("#"+r)):r=$(this).attr("id"),m(this),i=$(this).attr("id");var s=l(r,i);g(s,this)}),$(".selectMenuWrapper").on("click","div.mixType:not(.noConfig)",function(e){e.stopPropagation(),e.returnValue=!1,b.cancelLoad();var t=$(this).attr("data-subitemid"),i=t.split("_"),a=i[0],n=$("#"+a+" .selected").attr("id");n&&n!=t?m($("#"+n)):n=$(this).attr("data-subitemid"),m(this),t=$(this).attr("data-subitemid");var r=l(n,t);g(r,this)})}function s(){var e=b.getNumAngleStep(),t=$("#indicator ul li");t.eq(e/2).addClass("on"),$(b).on("singleAngleLoad",function(i){var a=i.angle;a+=e/2,a>=e&&(a-=e),t.eq(a).addClass("loaded")}),$(b).on("angleChange",function(i){var a=i.angle;O.hideAllDescriptions(),O.changeAngle(a),a+=e/2,a>=e&&(a-=e),t.removeClass("on"),t.eq(a).addClass("on")})}function o(e){if(e){var t=jsonPath(S,"$[..items[?(@.item_id=='"+e+"')]")[0];$(C).bind("loadComplete",B),$(C).bind("loadFailed",function(){}),C.loadSetting(t)}}function l(e,t){var i=[],a=$("#GRADE_LIST dd.GRD.selected").attr("id"),n=$("#EXT_BACKGROUND dd.BG.selected").attr("id"),r=$("#EXT_BODY_COLOR dd.BC.selected").attr("id"),s=$("#EXT_WHEEL dd.WH.selected").attr("id"),o=[],l=$("#INT_BASE dd.INTBASE.selected").attr("id"),c=$("#EXT_OPTION_ACCESSORY dd.radioType.selected");$.each(c,function(){var e=RegExp("\\b"+this.id+"\\b"),t=o.join(",");e.test(t)||o.push(this.id)}),c=$("#EXT_OPTION_ACCESSORY .checkType,#EXT_OPTION_ACCESSORY .mixType"),$.each(c,function(){var e=$(this).attr("data-subitemid");e||(e=this.id);var t=RegExp("\\b"+e+"\\b"),i=o.join(",");t.test(i)||o.push(e)}),i.push(a,n,r,s),i=i.concat(o),i.push(l),e&&t&&(i=d(i,e,t));var u=C.validate(i);return u}function d(e,t,i){var a=RegExp("\\b"+i+"\\b"),n=e.join(",");return a.test(n)||(a=RegExp("\\b"+t+"\\b")),n=n.replace(a,""),n=","==n.charAt(0)?n.replace(",",""):","==n.charAt(n.length-1)?n.replace("/,/$",""):n.replace(",,",","),e=n.split(","),e.unshift(i),"GRD_GL"!=$("#GRADE_LIST dd.GRD.selected").attr("id")&&"GRD_GL_D"!=$("#GRADE_LIST dd.GRD.selected").attr("id")||"E_001"!=t||"none"!=$("#C_001_I").css("display")||0!=$("#C_001_I").find(".selected").length||(e=d(e,"C_001_I","C_001")),e}function c(e){var t=$(".modeBtn.selected").attr("id");return"EXTERIOR"===t?C.getDisplayMaterials(A.EXT,e):"INTERIOR"===t?C.getDisplayMaterials(A.INT,e):void 0}function u(e){var t=$(".modeBtn.selected").attr("id");"EXTERIOR"===t?b.preloadManager(e):"INTERIOR"===t&&h(e)}function h(e){var t=S.materialDirPath;if(N){var i=e[0].material,a=t+i+"/"+i;$("#INT_BOX_Z1 img").attr("src",a+"_01.jpg"),$("#INT_BOX_Z2 img").attr("src",a+"_04.jpg"),$("#INT_BOX_X1 img").attr("src",a+"_03.jpg"),$("#INT_BOX_X2 img").attr("src",a+"_02.jpg"),$("#INT_BOX_Y1 img").attr("src",a+"_05.jpg"),$("#INT_BOX_Y2 img").attr("src",a+"_06.jpg")}else{clearInterval(R);var n;R=setInterval(function(){try{n=-1!=navigator.appName.indexOf("Microsoft")?window.InteriorView:document.InteriorView,n.setMaterials(t,e),clearInterval(R)}catch(i){}},200)}$("#loadingIndicator").stop(!0).show(10).delay(2e3).hide(10)}function g(e,t){$("#indicator ul li").removeClass("loaded");var i=!0;if(i){f(e.selectItems),p(e.disabledItems);var a=c(e.selectItems);a&&u(a)}else m(t);var n=$("#EXT_BODY_COLOR .selected .itemLabel").text(),r=$("#GRADE_LIST .selected .itemLabel").text();$("#gradeName p.bcLabel").text(n),$("#gradeName p.grdLabel").text(r),$("#EXT_BODY_COLOR span.bcLabel").text(n)}function f(e){for(var t=0;e.length>t;t++){var i=e[t];if(i){var a=i.split("_"),n=a[0],r=RegExp(D+"$"),s=$("#"+i),o=$('[data-subitemid="'+i+'"]'),l=s.size()||o.size();if(l)s.hasClass("radioType")||o.hasClass("radioType")?($("#"+n).find(".selected").removeClass(M),o.size()>0&&(s=v(s,o,i)),s.addClass(M),o.addClass(M)):r.test(i)?(s.removeClass(M),o.removeClass(M)):(o.size()>0&&(s=v(s,o,i)),s.addClass(M),o.addClass(M));else{var d=$("#"+_(i));if(d.size()>0&&!d.hasClass("radioType")){var c=_(i);s=$("#"+n).find("#"+c),o=$("#"+n).find('[data-subitemid="'+c+'"]'),s.toggleClass(M),o.toggleClass(M),s.attr("id",i),o.attr("data-subitemid",i)}}}}}function p(e){$("."+w).removeClass(w);for(var t=0;e.length>t;t++){var i=$("#"+e[t]);if(0===i.size()){var a=_(e[t]);i=$("#"+a)}else i.hasClass("selected")&&i.removeClass(M);i.addClass(w)}}function v(e,t,i){return e.size()>0&&(e=$(t.closest("dd")[0])),e.attr("id",i),e.find(".itemLabel")[0].innerHTML=t.find(".itemLabel")[0].innerHTML,e.find(".itemDescription")[0].innerHTML=t.find(".itemDescription")[0].innerHTML,e}function m(e){var t=$(e).attr("id");t||(t=$(e).attr("data-subitemid"));var i=_(t),a=t.split("_"),n=a[0],r=$("#"+n+" #"+t).attr("id",i);0===r.size()&&$("#"+n+" dd."+n).attr("id",i),$("#"+n).find('[data-subitemid="'+t+'"]').attr("data-subitemid",i)}function _(e){var t=RegExp(D+"$");return t.test(e)?e.replace(t,""):e+D}function y(e,t,i,a){$("<dt>").text(t).appendTo(e);for(var n=$(i).find("."+M).not(".subMenu ."+M),r=0;n.length>r;r++)if("none"!=n.eq(r).css("display")){var s='<dd><span class="itemLabel">'+n.eq(r).find(".itemLabel").html()+'</span><span class="itemDescription" style="display:'+(a?"block":"none")+'">'+n.eq(r).find(".itemDescription").html()+"</span></dd>";$(s).appendTo(e)}}function T(e){var t=$("#selectMenu").width(),i=$(".slideAreaWrap dl dd",e).outerWidth(!0),a=Math.floor(t/i),n=a*i,r=$(".slideAreaWrap dl dd", e).filter(function(){return ($(this).css("display")!="none");}).length,s=Math.floor((r-1)/a),o=0,l=$(".slideAreaWrap",e);l.css("margin-left","0px");var d=$(".slideNavi .pageIndicator",e);d.empty();for(var c=0;s>=c;c++)$("<li>").appendTo(d);$(".slideNavi .pageIndicator li",e).eq(0).addClass("on"),1>s?$(".slideNavi",e).hide():$(".slideNavi",e).show(),$(".slideNavi .slideL",e).off("click"),$(".slideNavi .slideL",e).on("click",function(){o--,0>o&&(o=0),l.stop(!0).animate({marginLeft:o*-n+"px"},500),$(".slideNavi .pageIndicator li",e).removeClass("on"),$(".slideNavi .pageIndicator li",e).eq(o).addClass("on")}),$(".slideNavi .slideR",e).off("click"),$(".slideNavi .slideR",e).on("click",function(){o++,o>s&&(o=s),l.stop(!0).animate({marginLeft:o*-n+"px"},500),$(".slideNavi .pageIndicator li",e).removeClass("on"),$(".slideNavi .pageIndicator li",e).eq(o).addClass("on")})}var b,C,I,A,S,E,L,O,R,M="selected",w="selectNotice",D="_I",N=RegExp("iphone|ipod|ipad|android|BlackBerry|Windows Phone","i").test(navigator.userAgent),x=function(){$(C).unbind("loadComplete"),$(C).unbind("loadFailed"),S=C.grade_list,b=new ConfigView({numAngles:36,numAngleStep:S.angleStep,materialDirPath:S.materialDirPath,displayTarget:"#exteriorStage",loadingIndicator:"#loadingIndicator"}),b.init(),b.createSelection("#GRADE_LIST div.slideAreaWrap",S,"#TMPL_ITEM"),o($("#GRADE_LIST .GRD.selected").attr("id"));for(var e="#indicator ul",t=b.getNumAngleStep(),i=0;t>i;i++){var l="<li>"+i+"</li>";$(l).appendTo(e)}a(),n(),r(),s(),T("#GRADE_LIST"),$("#func-point").on("click","#fp-descriptions .fp-closeBtn",function(){O.hideAllDescriptions()}),$("#featuresSwitch .fpSwitchBtn").on("click",function(){$(this).hasClass("on")?($(this).removeClass("on"),$("#func-point").hide(),O.hideAllDescriptions()):($(this).addClass("on"),$("#func-point").show())}),$("#selectMenu .menuTab-SMR").on("click",function(){$("#SUMMARY .summaryBlockLeft").empty(),$("#SUMMARY .summaryBlockRight").empty(),y("#SUMMARY .summaryBlockLeft","GRADE","#GRADE_LIST",!1),y("#SUMMARY .summaryBlockLeft","BODY COLOUR","#EXT_BODY_COLOR",!1),y("#SUMMARY .summaryBlockLeft","INTERIOR COLOUR","#INT_BASE",!1),y("#SUMMARY .summaryBlockRight","WHEEL","#EXT_WHEEL",!1),y("#SUMMARY .summaryBlockRight","OPTIONS&ACCESSORIES","#EXT_OPTION_ACCESSORY",!0)}),$(".selectMenuWrapper").on("click","dd.noConfig",function(){$(this).find(".noSimulationTooltip").stop(!0,!1).show(10).animate({opacity:1},3e3).hide(10)}),$(document).on("mousedown",function(e){0==$(e.target).parents(".subMenu").length&&$(".subMenu").hide()})},B=function(){$(C).unbind("loadComplete"),$(C).unbind("loadFailed"),$("#EXT_BACKGROUND div.slideAreaWrap").empty(),$("#EXT_BODY_COLOR div.slideAreaWrap").empty(),$("#EXT_WHEEL div.slideAreaWrap").empty(),$("#EXT_OPTION_ACCESSORY div.slideAreaWrap").empty(),$("#INT_BASE div.slideAreaWrap").empty(),I=C.item_list,A=C.materials_list,E=C.combination_list;var e=jsonPath(I,"$[.[?(@.category_id=='BACKGROUND')]");e&&b.createSelection("#EXT_BACKGROUND div.slideAreaWrap",e[0],"#TMPL_ITEM");var a=jsonPath(I,"$[.[?(@.category_id=='BODYCOLOR')]");if(a){b.createSelection("#EXT_BODY_COLOR div.slideAreaWrap",a[0],"#TMPL_ITEM");var n=42,r=0;$("#EXT_BODY_COLOR div.slideAreaWrap .BC").each(function(){var e=$(this).attr("id");e.split("_").length>2&&($(this).css({position:"absolute",top:"86px",left:r+"px"}),r+=n)})}var s=jsonPath(I,"$[.[?(@.category_id=='WHEELS')]");s&&b.createSelection("#EXT_WHEEL div.slideAreaWrap",s[0],"#TMPL_ITEM");var o=jsonPath(I,"$[.[?(@.category_id=='EXT_OPTION')]");o&&b.createSelection("#EXT_OPTION_ACCESSORY div.slideAreaWrap",o[0],"#TMPL_ITEM");var d=jsonPath(I,"$[.[?(@.category_id=='INT_BASE')]");d&&b.createSelection("#INT_BASE div.slideAreaWrap",d[0],"#TMPL_ITEM"),i(),t();var c=$("#modeSelect .selected");c&&$("#"+c[0].id.toLowerCase()+"Items").show();var u=l();g(u),T("#EXT_WHEEL"),T("#EXT_OPTION_ACCESSORY")};$(function(){e()})}();